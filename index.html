<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ã‹ã‚earthã‚¬ãƒãƒ£</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap');
  body {
    margin: 0; background: #f5f7fa; font-family: 'Kosugi Maru', sans-serif; color: #333;
    display: flex; flex-direction: column; align-items: center; min-height: 100vh;
  }
  header {
    background: #4a90e2; color: white; width: 100%; padding: 1.2em 0; text-align: center;
    font-size: 1.8em; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }
  main {
    max-width: 480px; width: 90%; margin: 1em auto; background: white; border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 1.5em;
  }
  button#drawBtn {
    background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
    border: none; border-radius: 8px; font-size: 1.4em; font-weight: 700; padding: 12px 0;
    width: 100%; color: #5b1a18; cursor: pointer; box-shadow: 0 5px 15px rgba(255,154,158,0.5);
    transition: transform 0.2s ease;
  }
  button#drawBtn:active {
    transform: scale(0.95);
  }
  #resultArea {
    margin-top: 1.2em; font-size: 1.6em; font-weight: 700; text-align: center;
    min-height: 48px; color: #de4c4a;
    user-select: none;
  }
  #itemsList, #historyList {
    margin-top: 1em; max-height: 180px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 1em;
  }
  .sectionTitle {
    font-weight: 700; margin-bottom: 0.5em; font-size: 1.2em; color: #444;
  }
  .itemCard {
    display: flex; justify-content: space-between; align-items: center;
    background: #fff3f3; border-radius: 8px; padding: 8px 12px; margin-bottom: 8px;
    box-shadow: 0 2px 6px rgba(222, 76, 74, 0.3);
  }
  .itemName {
    font-weight: 700; 
  }
  .itemCount {
    background: #b23a38; color: white; border-radius: 9999px; padding: 0 12px; font-weight: 700;
  }
  .historyEntry {
    font-size: 0.9em; padding: 6px 8px; border-bottom: 1px solid #eee;
    color: #666;
  }
  .historyEntry:last-child {
    border-bottom: none;
  }
  footer {
    margin-top: auto; padding: 1em 0; font-size: 0.9em; color: #999;
    user-select: none;
    text-align: center;
  }
</style>
</head>
<body>

<header>ã‹ã‚earthã‚¬ãƒãƒ£ ğŸ²</header>

<main>
  <button id="drawBtn">ã‚¬ãƒãƒ£ã‚’å¼•ã</button>
  <div id="resultArea">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>

  <section>
    <h2 class="sectionTitle">æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§</h2>
    <div id="itemsList"><i>ã¾ã ä½•ã‚‚æŒã£ã¦ã„ã¾ã›ã‚“ã€‚</i></div>
  </section>

  <section>
    <h2 class="sectionTitle">ã‚¬ãƒãƒ£å±¥æ­´</h2>
    <div id="historyList"><i>ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</i></div>
  </section>
</main>

<footer>
  <div>Â©ã‹ã‚earthã‚¬ãƒãƒ£</div>
  <div id="commitTime" style="font-size:0.8em; color:#bbb; margin-top:6px;">ã‚³ãƒŸãƒƒãƒˆæ—¥æ™‚ã‚’å–å¾—ä¸­â€¦</div>
  <div style="font-size:0.8em; margin-top:6px;">
    <a href="https://github.com/momijidaaa/Karogacha" target="_blank" rel="noopener noreferrer" style="color:#999; text-decoration:none; margin-right:12px;">GitHub ãƒªãƒã‚¸ãƒˆãƒª</a>
    <a href="https://github.com/momijidaaa/Karogacha/issues" target="_blank" rel="noopener noreferrer" style="color:#999; text-decoration:none;">Issues</a>
  </div>
</footer>

<script>
const items = [
  // ãƒãƒ¼ãƒãƒ«
  { id: "item001", name: "ã„ã‹", rarity: "N" },
  { id: "item002", name: "ç¥è–ãƒ­ãƒ¼ãƒå¸å›½", rarity: "N" },
  { id: "item100", name: "ã‚Šã", rarity: "R" },
  { id: "item101", name: "code", rarity: "N" },
  { id: "item102", name: "ssk", rarity: "N" },

  // Rç³»
  { id: "item003", name: "ãƒ‰ã‚¤ãƒ„å¸å›½", rarity: "R" },
  { id: "item103", name: "ãƒ—ãƒ­ã‚¤ã‚»ãƒ³ç‹å›½", rarity: "R" },
  { id: "item104", name: "ã‚¢ã‚¤ã‚¹ãƒ©ãƒ³ãƒ‰", rarity: "R+" },
  { id: "item105", name: "ã“ã‚ã§ã™", rarity: "R++" },

  // SRç³»
  { id: "item004", name: "ã‚ã ã‹", rarity: "SR" },
  { id: "item106", name: "ã‚‚ã¿ã˜", rarity: "SR+" },
  { id: "item16", name: "ãªã’", rarity: "SR+" },

  // SSRç³»
  { id: "item005", name: "ã‚‰ã‚‰ã", rarity: "SSR" },
  { id: "item0q5", name: "ntldr", rarity: "SSR" },
  { id: "item107", name: "è¦ªå­ä¸¼", rarity: "SSR+" },
  { id: "item478", name: "ã¾ãƒ¼ãã‚“", rarity: "SSR+" },

  // URç³»
  { id: "item006", name: "å¤§æ—¥æœ¬å¸å›½", rarity: "UR" },

  // MRç³»
  { id: "item028", name: "é›·", rarity: "MR" },

  // LRç³»
  { id: "item030", name: "ã“ã¯ãâ™¡ã¨ãã‚ã„", rarity: "LR" },

  // ERç³»
  { id: "item060", name: "ã—ã‚ã“", rarity: "ER" },
  { id: "item1900", name: "GhostHax", rarity: "ER" },

  // GRç³»
  { id: "item200", name: "ã‹ã‚ã‚“", rarity: "GR" }
];

// ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚«ãƒ©ãƒ¼è¨­å®š
const rarityColors = {
  GR: "#ffd700",    // ã‚´ãƒ¼ãƒ«ãƒ‰
  ER: "#ffa500",    // ã‚ªãƒ¬ãƒ³ã‚¸
  LR: "#ff8000",    // ãƒ€ãƒ¼ã‚¯ã‚ªãƒ¬ãƒ³ã‚¸
  MR: "#b366ff",    // ãƒ‘ãƒ¼ãƒ—ãƒ«
  UR: "#db2777",    // ãƒ”ãƒ³ã‚¯
  SSR: "#ef4444",   // èµ¤
  "SSR+": "#f87171",// ãƒ©ã‚¤ãƒˆãƒ¬ãƒƒãƒ‰
  SR: "#facc15",    // é»„
  "SR+": "#fcd34d", // ãƒ©ã‚¤ãƒˆã‚¤ã‚¨ãƒ­ãƒ¼
  R: "#3b82f6",     // é’
  "R+": "#60a5fa",  // ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼
  "R++": "#93c5fd", // è–„é’
  N: "#a0a0a0"      // ã‚°ãƒ¬ãƒ¼
};

// æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ ï¼ˆid: countï¼‰
const ownedItems = {};
// ã‚¬ãƒãƒ£å±¥æ­´ï¼ˆ[{name, date}]ï¼‰
const history = [];

const drawBtn = document.getElementById("drawBtn");
const resultArea = document.getElementById("resultArea");
const itemsList = document.getElementById("itemsList");
const historyList = document.getElementById("historyList");

// ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ï¼ˆåˆè¨ˆã¯æ°—ã«ã—ãªãã¦OKï¼‰
const rarityRates = {
  GR: 0.05,
  ER: 0.1,
  LR: 0.15,
  MR: 0.2,
  UR: 0.3,
  SSR: 1,
  "SSR+": 1.5,
  SR: 3,
  "SR+": 3,
  R: 8,
  "R+": 10,
  "R++": 8,
  N: 50.2,
};

function getRandomRarity() {
  const rand = Math.random() * 100;
  let sum = 0;
  for (const [rarity, rate] of Object.entries(rarityRates)) {
    sum += rate;
    if (rand < sum) return rarity;
  }
  return "N";
}

function getRandomItem() {
  const rarity = getRandomRarity();
  const candidates = items.filter((item) => item.rarity === rarity);
  if (candidates.length > 0) {
    const idx = Math.floor(Math.random() * candidates.length);
    return candidates[idx];
  }
  return items.find((i) => i.rarity === "N");
}

// ãƒ¬ã‚¢ãƒªãƒ†ã‚£é †åºï¼ˆé«˜ã„é †ï¼‰
const rarityOrder = [
  "GR", "ER", "LR", "MR", "UR",
  "SSR+", "SSR",
  "SR+", "SR",
  "R+", "R++", "R",
  "N"
];

// æ‰€æŒã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒ¬ã‚¢åº¦é †ã«ã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤º
function updateOwnedList() {
  if (Object.keys(ownedItems).length === 0) {
    itemsList.innerHTML = "<i>ã¾ã ä½•ã‚‚æŒã£ã¦ã„ã¾ã›ã‚“ã€‚</i>";
    return;
  }
  itemsList.innerHTML = "";

  const ownedArray = Object.entries(ownedItems).map(([id, count]) => {
    const item = items.find(i => i.id === id);
    return { ...item, count };
  });

  ownedArray.sort((a, b) => {
    return rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity);
  });

  for (const item of ownedArray) {
    const card = document.createElement("div");
    card.className = "itemCard";
    card.style.border = `2px solid ${rarityColors[item.rarity]}`;
    card.innerHTML = `
      <span class="itemName" style="color:${rarityColors[item.rarity]}">${item.name}</span>
      <span class="itemCount">Ã—${item.count}</span>
    `;
    itemsList.appendChild(card);
  }
}

// ã‚¬ãƒãƒ£å±¥æ­´è¡¨ç¤ºæ›´æ–°
function updateHistory() {
  if (history.length === 0) {
    historyList.innerHTML = "<i>ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</i>";
    return;
  }
  historyList.innerHTML = "";
  history
    .slice()
    .reverse()
    .forEach((entry) => {
      const div = document.createElement("div");
      div.className = "historyEntry";
      div.textContent = `${entry.date} - ${entry.name}`;
      historyList.appendChild(div);
    });
}

// çµæœè¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
function animateResult(text, color) {
  resultArea.style.color = color;
  resultArea.textContent = "";
  let index = 0;
  const interval = setInterval(() => {
    if (index < text.length) {
      resultArea.textContent += text[index];
      index++;
    } else {
      clearInterval(interval);
    }
  }, 60);
}

drawBtn.addEventListener("click", () => {
  drawBtn.disabled = true;
  const item = getRandomItem();
  ownedItems[item.id] = (ownedItems[item.id] || 0) + 1;
  const now = new Date();
  const dateStr = now.toLocaleString("ja-JP", { hour12: false });
  history.push({ name: item.name, date: dateStr });
  animateResult(`ğŸ‰ ${item.name} ã‚’ã‚²ãƒƒãƒˆï¼`, rarityColors[item.rarity]);
  updateOwnedList();
  updateHistory();
  setTimeout(() => {
    drawBtn.disabled = false;
  }, 1500);
});

// GitHubãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±
const githubUser = 'momijidaaa';
const githubRepo = 'Karogacha';

// GitHubæœ€æ–°ã‚³ãƒŸãƒƒãƒˆæ—¥æ™‚å–å¾—è¡¨ç¤º
async function fetchLatestCommitTime() {
  const url = `https://api.github.com/repos/${githubUser}/${githubRepo}/commits?per_page=1`;
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error('GitHub APIã‚¨ãƒ©ãƒ¼');
    const commits = await res.json();
    if (commits.length === 0) throw new Error('ã‚³ãƒŸãƒƒãƒˆãªã—');
    const dateStr = commits[0].commit.committer.date;
    const date = new Date(dateStr);
    const formatted = date.toLocaleString('ja-JP', { hour12: false });
    document.getElementById('commitTime').textContent = `æœ€æ–°ã‚³ãƒŸãƒƒãƒˆ: ${formatted}`;
  } catch (e) {
    document.getElementById('commitTime').textContent = 'æœ€æ–°ã‚³ãƒŸãƒƒãƒˆæ—¥æ™‚ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
    console.error(e);
  }
}

fetchLatestCommitTime();

// åˆæœŸè¡¨ç¤ºæ›´æ–°
updateOwnedList();
updateHistory();

</script>

</body>
</html>